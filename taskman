#!/usr/bin/env ruby

$tableau_taches = [
	{ id: 0, :content => "Ameliorer taskman", flags: %w(important urgent) }
]

OPTIONS_DEFAULT = {
	flags: [],
	date: nil
}

def parser_commande command
	case command
	when 'add'
		$tableau_taches << ajouter(ARGV)
	when 'del'
		supprimer ARGV.shift.to_i
	when 'mod'
		puts 'faire action modifier'
	when 'list'
		puts 'permet de lister et filtrer nos taches'
	else
		puts 'faire autrechose'
	end
end

def supprimer id
	$tableau_taches.reject{|tache| tache[:id]==id }
end

# Retourne une tache
def ajouter params
	contenu = params.shift

	tache = {}

	tache[:id] = $tableau_taches.map{ |tache| tache[:id] }.max+1



	tache.merge!(OPTIONS_DEFAULT)


	tache[:content] = contenu

	params.each do |argument|
		champ, valeur = argument.split(':')

		if champ == "flags"
			tache[champ.to_sym] = valeur.split(",")
		else
			tache[champ.to_sym] = valeur
		end
	end

	tache
end


def afficher
	puts "*****TASKMAN*****"
	puts "LISTE DES TACHES "

	$tableau_taches.each do |tache|
		puts "#{tache[:id]} - #{tache[:content]} (#{tache[:flags].join(",")})"
	end
end

command = ARGV.shift
parser_commande(command)
afficher